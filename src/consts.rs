#![allow(dead_code)]

use std::ops::Deref;

use crate::params::Q;
pub const QINV: i32 = -1073479679; // q^-1 mod 2^32
pub const MONT: u32 = 1048572; // 2^32 mod q
pub const MONTSQ: u32 = 260045840; // 2^64 mod q
pub const DIV: i32 = -132153352; // mont^2/128 mod q

pub const _8XQ: usize = 0;
pub const _8XQINV: usize = 8;
pub const _8XDIV: usize = 16;
pub const _PMASK: usize = 24;
pub const _ZETAS: usize = 32;
pub const _ZETAS_QINV: usize = 160;

#[repr(align(64))]
pub struct QData(pub [i32; 288]);

impl Deref for QData {
    type Target = [i32; 288];
    fn deref(&self) -> &Self::Target {
        &self.0
    }
}

pub const QDATA : QData = QData([
    // Q (indexed by _8XQ)
    Q, Q, Q, Q, Q, Q, Q, Q,

    // QINV (indexed by _8XQINV)
    QINV, QINV, QINV, QINV, QINV, QINV, QINV, QINV,

    // DIV (indexed by _8XDIV)
    DIV, DIV, DIV, DIV, DIV, DIV, DIV, DIV,

    // PMASK (indexed by _PMASK)
    7, 6, 5, 4, 3, 2, 1, 0,

    // ZETAS (indexed by _ZETAS)
     175040315,  331967329,  456276144,  454844763,  159980059, -478416174, -416659981, -320115552,
     238916051, -526806357,   39916768,  416926366,  397736216,   24955502,  304385919, -220562147,
    -312057843,  428266697,  382814741,   43923579, -113026495,  528865927,  -72521175, -472785220,
    -484244295, -405963773,  -95373355, -231657752,  419693733,  354932988,  210173399,  167562464,
     473515325, -173011427, -192724796, -390110669,  115572728,  -17391882, -171627748, -495644362,
     405439465,   40340982,  129757077,  160093967,  411895201,  263048769,  429963517, -384800154,
      15135544, -405343018, -212266845, -235262439,  285486254,  457308136, -364668038, -365165724,
    -293385227,  441800469, -418935751, -311687394, -422161617, -310379038,  262878662,  454568304,
    -250688461, -257602554,  197375900,  403767085,  382333025, -527643241, -205954134,  107243165,
     281152895, -317922323, -529131691, -227675423,  266434172,  386284822, -383005382,  254142543,
    -425720413, -141999989, -295055895,   81037018,  338701692,   78331885,  -65754902,  134085298,
     400841409,  -21467763,  -71151847,   -2164837,    6508487,   76696199, -293884740,  251502129,
     250304896,  -88835585,  405957924, -166638639,  463379170,  431164203, -206594448, -204978956,
    -340279225,  231165312,  265778546,  330774173,  299880748,  468083183, -414882508,  108190920,
     394320170, -100651400, -274409332,   88131428, -454290819,  182506441,  -70451475, -230436531,
      93990932, -432488013, -479196700,    7765600,  -94141852, -213056140, -525337670,          0,

    // ZETAS_QINV (indexed by _ZETAS_QINV)
     -413472965, -2125632671,   -34457424,  -527933093, -1309337061,   784593618,  1056327155, -1620349792,
    -1786146349,  1799721643,  1440814304, -1018049890,   -65734376, -1422603666, -1876914305, -1488028387,
      765091853,   749393097,   -14333419,   613038203,   575101505,  -912139641,  1683057193,  1589763772,
    -1241054023,   400129027, -1717258283, -1378799896,  -342358875,  2031606012,  1138949591,  1031589088,
     -248691395,  -299626979,  -141344572, -1316265421,   113475576,   -87122186, -1573573860, -1488121546,
     -405896215, -1170240010, -2045775979, -1513695473,  -284097119,   145870401, -1114326787,   313027174,
     -842599624,   992933078,  1977946275,  1784557081,  1136405678,   -85854232,  -668230790,  -137624732,
     -564704267,   917067541,  -672428999, -1981544674,  1938969391,  1695022562,  1724069318, -1059575440,
     1641729075, -1598206970,  -365709412,  -725287123, -1739722655,  1458097559,    39936938,  1624794781,
    -2034365057,  1019274221,   -37087403,  2113008353,  -372148612, -1956758250, -1642869446,  -262018993,
     1026295203,   968179851,  -435302935, -1606646054,  -903860868, -1000390675,   532457706,  1925577394,
     1122523841,  1961651597,  -131707111,   508229531,  2139049927,  1856916103, -1586778948,  1203871281,
     1961580928,   581990911,  -859673308,  -447394863,   119970530, -2040591573,  1836031600,   127419636,
      752074823,  1137134976,  1704949106, -1372899683,  1452265772,  -475897361,  2081776948,  2039667912,
      -64431830, -1277153672,  1372903564,   584107876,  -287305091,   436523977, -1216282899,  -143142579,
     -974508012,   755286451,   184551908,  -101286304,    66290276,   152896884,  1335360442,           0,
]);

#[repr(align(64))]
pub struct RejIdx(pub [[u8; 8]; 256]);

impl Deref for RejIdx {
    type Target = [[u8; 8]; 256];

    fn deref(&self) -> &Self::Target {
        &self.0
    }
}

pub const REJIDX: RejIdx = RejIdx ([
  [ 0,  0,  0,  0,  0,  0,  0,  0], [ 0,  0,  0,  0,  0,  0,  0,  0], [ 1,  0,  0,  0,  0,  0,  0,  0],
  [ 0,  1,  0,  0,  0,  0,  0,  0], [ 2,  0,  0,  0,  0,  0,  0,  0], [ 0,  2,  0,  0,  0,  0,  0,  0],
  [ 1,  2,  0,  0,  0,  0,  0,  0], [ 0,  1,  2,  0,  0,  0,  0,  0], [ 3,  0,  0,  0,  0,  0,  0,  0],
  [ 0,  3,  0,  0,  0,  0,  0,  0], [ 1,  3,  0,  0,  0,  0,  0,  0], [ 0,  1,  3,  0,  0,  0,  0,  0],
  [ 2,  3,  0,  0,  0,  0,  0,  0], [ 0,  2,  3,  0,  0,  0,  0,  0], [ 1,  2,  3,  0,  0,  0,  0,  0],
  [ 0,  1,  2,  3,  0,  0,  0,  0], [ 4,  0,  0,  0,  0,  0,  0,  0], [ 0,  4,  0,  0,  0,  0,  0,  0],
  [ 1,  4,  0,  0,  0,  0,  0,  0], [ 0,  1,  4,  0,  0,  0,  0,  0], [ 2,  4,  0,  0,  0,  0,  0,  0],
  [ 0,  2,  4,  0,  0,  0,  0,  0], [ 1,  2,  4,  0,  0,  0,  0,  0], [ 0,  1,  2,  4,  0,  0,  0,  0],
  [ 3,  4,  0,  0,  0,  0,  0,  0], [ 0,  3,  4,  0,  0,  0,  0,  0], [ 1,  3,  4,  0,  0,  0,  0,  0],
  [ 0,  1,  3,  4,  0,  0,  0,  0], [ 2,  3,  4,  0,  0,  0,  0,  0], [ 0,  2,  3,  4,  0,  0,  0,  0],
  [ 1,  2,  3,  4,  0,  0,  0,  0], [ 0,  1,  2,  3,  4,  0,  0,  0], [ 5,  0,  0,  0,  0,  0,  0,  0],
  [ 0,  5,  0,  0,  0,  0,  0,  0], [ 1,  5,  0,  0,  0,  0,  0,  0], [ 0,  1,  5,  0,  0,  0,  0,  0],
  [ 2,  5,  0,  0,  0,  0,  0,  0], [ 0,  2,  5,  0,  0,  0,  0,  0], [ 1,  2,  5,  0,  0,  0,  0,  0],
  [ 0,  1,  2,  5,  0,  0,  0,  0], [ 3,  5,  0,  0,  0,  0,  0,  0], [ 0,  3,  5,  0,  0,  0,  0,  0],
  [ 1,  3,  5,  0,  0,  0,  0,  0], [ 0,  1,  3,  5,  0,  0,  0,  0], [ 2,  3,  5,  0,  0,  0,  0,  0],
  [ 0,  2,  3,  5,  0,  0,  0,  0], [ 1,  2,  3,  5,  0,  0,  0,  0], [ 0,  1,  2,  3,  5,  0,  0,  0],
  [ 4,  5,  0,  0,  0,  0,  0,  0], [ 0,  4,  5,  0,  0,  0,  0,  0], [ 1,  4,  5,  0,  0,  0,  0,  0],
  [ 0,  1,  4,  5,  0,  0,  0,  0], [ 2,  4,  5,  0,  0,  0,  0,  0], [ 0,  2,  4,  5,  0,  0,  0,  0],
  [ 1,  2,  4,  5,  0,  0,  0,  0], [ 0,  1,  2,  4,  5,  0,  0,  0], [ 3,  4,  5,  0,  0,  0,  0,  0],
  [ 0,  3,  4,  5,  0,  0,  0,  0], [ 1,  3,  4,  5,  0,  0,  0,  0], [ 0,  1,  3,  4,  5,  0,  0,  0],
  [ 2,  3,  4,  5,  0,  0,  0,  0], [ 0,  2,  3,  4,  5,  0,  0,  0], [ 1,  2,  3,  4,  5,  0,  0,  0],
  [ 0,  1,  2,  3,  4,  5,  0,  0], [ 6,  0,  0,  0,  0,  0,  0,  0], [ 0,  6,  0,  0,  0,  0,  0,  0],
  [ 1,  6,  0,  0,  0,  0,  0,  0], [ 0,  1,  6,  0,  0,  0,  0,  0], [ 2,  6,  0,  0,  0,  0,  0,  0],
  [ 0,  2,  6,  0,  0,  0,  0,  0], [ 1,  2,  6,  0,  0,  0,  0,  0], [ 0,  1,  2,  6,  0,  0,  0,  0],
  [ 3,  6,  0,  0,  0,  0,  0,  0], [ 0,  3,  6,  0,  0,  0,  0,  0], [ 1,  3,  6,  0,  0,  0,  0,  0],
  [ 0,  1,  3,  6,  0,  0,  0,  0], [ 2,  3,  6,  0,  0,  0,  0,  0], [ 0,  2,  3,  6,  0,  0,  0,  0],
  [ 1,  2,  3,  6,  0,  0,  0,  0], [ 0,  1,  2,  3,  6,  0,  0,  0], [ 4,  6,  0,  0,  0,  0,  0,  0],
  [ 0,  4,  6,  0,  0,  0,  0,  0], [ 1,  4,  6,  0,  0,  0,  0,  0], [ 0,  1,  4,  6,  0,  0,  0,  0],
  [ 2,  4,  6,  0,  0,  0,  0,  0], [ 0,  2,  4,  6,  0,  0,  0,  0], [ 1,  2,  4,  6,  0,  0,  0,  0],
  [ 0,  1,  2,  4,  6,  0,  0,  0], [ 3,  4,  6,  0,  0,  0,  0,  0], [ 0,  3,  4,  6,  0,  0,  0,  0],
  [ 1,  3,  4,  6,  0,  0,  0,  0], [ 0,  1,  3,  4,  6,  0,  0,  0], [ 2,  3,  4,  6,  0,  0,  0,  0],
  [ 0,  2,  3,  4,  6,  0,  0,  0], [ 1,  2,  3,  4,  6,  0,  0,  0], [ 0,  1,  2,  3,  4,  6,  0,  0],
  [ 5,  6,  0,  0,  0,  0,  0,  0], [ 0,  5,  6,  0,  0,  0,  0,  0], [ 1,  5,  6,  0,  0,  0,  0,  0],
  [ 0,  1,  5,  6,  0,  0,  0,  0], [ 2,  5,  6,  0,  0,  0,  0,  0], [ 0,  2,  5,  6,  0,  0,  0,  0],
  [ 1,  2,  5,  6,  0,  0,  0,  0], [ 0,  1,  2,  5,  6,  0,  0,  0], [ 3,  5,  6,  0,  0,  0,  0,  0],
  [ 0,  3,  5,  6,  0,  0,  0,  0], [ 1,  3,  5,  6,  0,  0,  0,  0], [ 0,  1,  3,  5,  6,  0,  0,  0],
  [ 2,  3,  5,  6,  0,  0,  0,  0], [ 0,  2,  3,  5,  6,  0,  0,  0], [ 1,  2,  3,  5,  6,  0,  0,  0],
  [ 0,  1,  2,  3,  5,  6,  0,  0], [ 4,  5,  6,  0,  0,  0,  0,  0], [ 0,  4,  5,  6,  0,  0,  0,  0],
  [ 1,  4,  5,  6,  0,  0,  0,  0], [ 0,  1,  4,  5,  6,  0,  0,  0], [ 2,  4,  5,  6,  0,  0,  0,  0],
  [ 0,  2,  4,  5,  6,  0,  0,  0], [ 1,  2,  4,  5,  6,  0,  0,  0], [ 0,  1,  2,  4,  5,  6,  0,  0],
  [ 3,  4,  5,  6,  0,  0,  0,  0], [ 0,  3,  4,  5,  6,  0,  0,  0], [ 1,  3,  4,  5,  6,  0,  0,  0],
  [ 0,  1,  3,  4,  5,  6,  0,  0], [ 2,  3,  4,  5,  6,  0,  0,  0], [ 0,  2,  3,  4,  5,  6,  0,  0],
  [ 1,  2,  3,  4,  5,  6,  0,  0], [ 0,  1,  2,  3,  4,  5,  6,  0], [ 7,  0,  0,  0,  0,  0,  0,  0],
  [ 0,  7,  0,  0,  0,  0,  0,  0], [ 1,  7,  0,  0,  0,  0,  0,  0], [ 0,  1,  7,  0,  0,  0,  0,  0],
  [ 2,  7,  0,  0,  0,  0,  0,  0], [ 0,  2,  7,  0,  0,  0,  0,  0], [ 1,  2,  7,  0,  0,  0,  0,  0],
  [ 0,  1,  2,  7,  0,  0,  0,  0], [ 3,  7,  0,  0,  0,  0,  0,  0], [ 0,  3,  7,  0,  0,  0,  0,  0],
  [ 1,  3,  7,  0,  0,  0,  0,  0], [ 0,  1,  3,  7,  0,  0,  0,  0], [ 2,  3,  7,  0,  0,  0,  0,  0],
  [ 0,  2,  3,  7,  0,  0,  0,  0], [ 1,  2,  3,  7,  0,  0,  0,  0], [ 0,  1,  2,  3,  7,  0,  0,  0],
  [ 4,  7,  0,  0,  0,  0,  0,  0], [ 0,  4,  7,  0,  0,  0,  0,  0], [ 1,  4,  7,  0,  0,  0,  0,  0],
  [ 0,  1,  4,  7,  0,  0,  0,  0], [ 2,  4,  7,  0,  0,  0,  0,  0], [ 0,  2,  4,  7,  0,  0,  0,  0],
  [ 1,  2,  4,  7,  0,  0,  0,  0], [ 0,  1,  2,  4,  7,  0,  0,  0], [ 3,  4,  7,  0,  0,  0,  0,  0],
  [ 0,  3,  4,  7,  0,  0,  0,  0], [ 1,  3,  4,  7,  0,  0,  0,  0], [ 0,  1,  3,  4,  7,  0,  0,  0],
  [ 2,  3,  4,  7,  0,  0,  0,  0], [ 0,  2,  3,  4,  7,  0,  0,  0], [ 1,  2,  3,  4,  7,  0,  0,  0],
  [ 0,  1,  2,  3,  4,  7,  0,  0], [ 5,  7,  0,  0,  0,  0,  0,  0], [ 0,  5,  7,  0,  0,  0,  0,  0],
  [ 1,  5,  7,  0,  0,  0,  0,  0], [ 0,  1,  5,  7,  0,  0,  0,  0], [ 2,  5,  7,  0,  0,  0,  0,  0],
  [ 0,  2,  5,  7,  0,  0,  0,  0], [ 1,  2,  5,  7,  0,  0,  0,  0], [ 0,  1,  2,  5,  7,  0,  0,  0],
  [ 3,  5,  7,  0,  0,  0,  0,  0], [ 0,  3,  5,  7,  0,  0,  0,  0], [ 1,  3,  5,  7,  0,  0,  0,  0],
  [ 0,  1,  3,  5,  7,  0,  0,  0], [ 2,  3,  5,  7,  0,  0,  0,  0], [ 0,  2,  3,  5,  7,  0,  0,  0],
  [ 1,  2,  3,  5,  7,  0,  0,  0], [ 0,  1,  2,  3,  5,  7,  0,  0], [ 4,  5,  7,  0,  0,  0,  0,  0],
  [ 0,  4,  5,  7,  0,  0,  0,  0], [ 1,  4,  5,  7,  0,  0,  0,  0], [ 0,  1,  4,  5,  7,  0,  0,  0],
  [ 2,  4,  5,  7,  0,  0,  0,  0], [ 0,  2,  4,  5,  7,  0,  0,  0], [ 1,  2,  4,  5,  7,  0,  0,  0],
  [ 0,  1,  2,  4,  5,  7,  0,  0], [ 3,  4,  5,  7,  0,  0,  0,  0], [ 0,  3,  4,  5,  7,  0,  0,  0],
  [ 1,  3,  4,  5,  7,  0,  0,  0], [ 0,  1,  3,  4,  5,  7,  0,  0], [ 2,  3,  4,  5,  7,  0,  0,  0],
  [ 0,  2,  3,  4,  5,  7,  0,  0], [ 1,  2,  3,  4,  5,  7,  0,  0], [ 0,  1,  2,  3,  4,  5,  7,  0],
  [ 6,  7,  0,  0,  0,  0,  0,  0], [ 0,  6,  7,  0,  0,  0,  0,  0], [ 1,  6,  7,  0,  0,  0,  0,  0],
  [ 0,  1,  6,  7,  0,  0,  0,  0], [ 2,  6,  7,  0,  0,  0,  0,  0], [ 0,  2,  6,  7,  0,  0,  0,  0],
  [ 1,  2,  6,  7,  0,  0,  0,  0], [ 0,  1,  2,  6,  7,  0,  0,  0], [ 3,  6,  7,  0,  0,  0,  0,  0],
  [ 0,  3,  6,  7,  0,  0,  0,  0], [ 1,  3,  6,  7,  0,  0,  0,  0], [ 0,  1,  3,  6,  7,  0,  0,  0],
  [ 2,  3,  6,  7,  0,  0,  0,  0], [ 0,  2,  3,  6,  7,  0,  0,  0], [ 1,  2,  3,  6,  7,  0,  0,  0],
  [ 0,  1,  2,  3,  6,  7,  0,  0], [ 4,  6,  7,  0,  0,  0,  0,  0], [ 0,  4,  6,  7,  0,  0,  0,  0],
  [ 1,  4,  6,  7,  0,  0,  0,  0], [ 0,  1,  4,  6,  7,  0,  0,  0], [ 2,  4,  6,  7,  0,  0,  0,  0],
  [ 0,  2,  4,  6,  7,  0,  0,  0], [ 1,  2,  4,  6,  7,  0,  0,  0], [ 0,  1,  2,  4,  6,  7,  0,  0],
  [ 3,  4,  6,  7,  0,  0,  0,  0], [ 0,  3,  4,  6,  7,  0,  0,  0], [ 1,  3,  4,  6,  7,  0,  0,  0],
  [ 0,  1,  3,  4,  6,  7,  0,  0], [ 2,  3,  4,  6,  7,  0,  0,  0], [ 0,  2,  3,  4,  6,  7,  0,  0],
  [ 1,  2,  3,  4,  6,  7,  0,  0], [ 0,  1,  2,  3,  4,  6,  7,  0], [ 5,  6,  7,  0,  0,  0,  0,  0],
  [ 0,  5,  6,  7,  0,  0,  0,  0], [ 1,  5,  6,  7,  0,  0,  0,  0], [ 0,  1,  5,  6,  7,  0,  0,  0],
  [ 2,  5,  6,  7,  0,  0,  0,  0], [ 0,  2,  5,  6,  7,  0,  0,  0], [ 1,  2,  5,  6,  7,  0,  0,  0],
  [ 0,  1,  2,  5,  6,  7,  0,  0], [ 3,  5,  6,  7,  0,  0,  0,  0], [ 0,  3,  5,  6,  7,  0,  0,  0],
  [ 1,  3,  5,  6,  7,  0,  0,  0], [ 0,  1,  3,  5,  6,  7,  0,  0], [ 2,  3,  5,  6,  7,  0,  0,  0],
  [ 0,  2,  3,  5,  6,  7,  0,  0], [ 1,  2,  3,  5,  6,  7,  0,  0], [ 0,  1,  2,  3,  5,  6,  7,  0],
  [ 4,  5,  6,  7,  0,  0,  0,  0], [ 0,  4,  5,  6,  7,  0,  0,  0], [ 1,  4,  5,  6,  7,  0,  0,  0],
  [ 0,  1,  4,  5,  6,  7,  0,  0], [ 2,  4,  5,  6,  7,  0,  0,  0], [ 0,  2,  4,  5,  6,  7,  0,  0],
  [ 1,  2,  4,  5,  6,  7,  0,  0], [ 0,  1,  2,  4,  5,  6,  7,  0], [ 3,  4,  5,  6,  7,  0,  0,  0],
  [ 0,  3,  4,  5,  6,  7,  0,  0], [ 1,  3,  4,  5,  6,  7,  0,  0], [ 0,  1,  3,  4,  5,  6,  7,  0],
  [ 2,  3,  4,  5,  6,  7,  0,  0], [ 0,  2,  3,  4,  5,  6,  7,  0], [ 1,  2,  3,  4,  5,  6,  7,  0],
  [ 0,  1,  2,  3,  4,  5,  6,  7]
]); 

